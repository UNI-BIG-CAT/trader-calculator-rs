import { Button, VerticalBox, HorizontalBox, ListView, LineEdit, ScrollView } from "std-widgets.slint";
import { OpenStockData } from "../data.slint";

export component CreateStockDialog inherits Rectangle {
    in-out property <bool> show: false;
    in-out property <string> stock_name: "";
    in-out property <int> stock_type: 1;      // 默认沪市
    in-out property <string> current_price_text: ""; // 当前价格
    in-out property <string> transaction_price_text: ""; // 建仓价格
    in-out property <string> transaction_amount_text: ""; // 建仓数量
    callback open_stock_confirmed(OpenStockData);
    callback dialog_cancelled();
    
    // 只有在显示时才渲染
    visible: show;
    
    // 遮罩层 - 覆盖整个窗口
    background: rgba(0, 0, 0, 0.5);
    
    // 对话框居中容器
    VerticalBox {
        alignment: center;
        HorizontalBox {
            alignment: center;
            
            // 实际的对话框内容
            Rectangle {
                width: 450px;
                min-height: 500px;  // 使用最小高度而非固定高度
                background: white;
                border-radius: 8px;
                drop-shadow-color: rgba(0, 0, 0, 0.3);
                drop-shadow-offset-x: 0px;
                drop-shadow-offset-y: 4px;
                drop-shadow-blur: 10px;
                ScrollView {
                    VerticalBox {
                        padding: 20px;
                        spacing: 15px;
                        // 标题
                        Text {
                            text: "建仓股票";
                            font-size: 20px;
                            font-weight: 700;
                            color: #333;
                            horizontal-alignment: center;
                        }
                        
                        // 股票名称输入
                        VerticalBox {
                            spacing: 8px;
                            Text {
                                text: "股票名称：";
                                font-size: 14px;
                                font-weight: 600;
                                color: #555;
                            }

                            LineEdit {
                                placeholder-text: "请输入股票名称";
                                text <=> stock_name;
                                font-size: 14px;
                                height: 36px;
                            }
                        }
                        
                        // 股票类型选择
                        HorizontalBox {
                            spacing: 30px;
                            alignment: start;
                            Text {
                                text: "股票类型：";
                                font-size: 14px;
                                font-weight: 600;
                                color: #555;
                            }

                            // 沪市按钮
                            Rectangle {
                                width: 90px;
                                height: 30px;
                                background: stock_type == 1 ? #FE9900 : #f8f9fa;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: stock_type == 1 ? #FE9900 : #dee2e6;
                                Text {
                                    text: "沪市";
                                    color: stock_type == 1 ? white : #6c757d;
                                    font-size: 10px;
                                    font-weight: 600;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }

                                TouchArea {
                                    clicked => {
                                        stock_type = 1;
                                    }
                                }
                            }
                            // 深市按钮
                            Rectangle {
                                width: 90px;
                                height: 30px;
                                background: stock_type == 2 ? #FE9900 : #f8f9fa;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: stock_type == 2 ? #FE9900 : #dee2e6;
                                Text {
                                    text: "深市";
                                    color: stock_type == 2 ? white : #6c757d;
                                    font-size: 10px;
                                    font-weight: 600;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }

                                TouchArea {
                                    clicked => {
                                        stock_type = 2;
                                    }
                                }
                            }
                        }
                        
                        // 当前价格输入
                        VerticalBox {
                            spacing: 8px;
                            Text {
                                text: "当前价格（元）：";
                                font-size: 14px;
                                font-weight: 600;
                                color: #555;
                            }

                            LineEdit {
                                placeholder-text: "请输入当前价格";
                                text <=> current_price_text;
                                font-size: 14px;
                            }
                        }
                        // 建仓价格输入
                        VerticalBox {
                            spacing: 8px;
                            Text {
                                text: "建仓价格（元）：";
                                font-size: 14px;
                                font-weight: 600;
                                color: #555;
                            }

                            LineEdit {
                                placeholder-text: "请输入建仓价格";
                                text <=> transaction_price_text;
                                font-size: 14px;
                                height: 36px;
                                input-type: decimal;
                            }
                        }
                        
                        // 建仓数量输入
                        VerticalBox {
                            spacing: 8px;
                            Text {
                                text: "建仓数量（股）：";
                                font-size: 14px;
                                font-weight: 600;
                                color: #555;
                            }

                            LineEdit {
                                placeholder-text: "请输入建仓数量";
                                text <=> transaction_amount_text;
                                font-size: 14px;
                                height: 36px;
                                input-type: number;
                            }
                        }
                        
                        // 按钮区域
                        HorizontalBox {
                            spacing: 50px;
                            alignment: center;
                            padding-top: 10px;
                            
                            // 取消按钮
                            Rectangle {
                                width: 90px;
                                height: 40px;
                                background: #f8f9fa;
                                border-radius: 6px;
                                Text {
                                    text: "取消";
                                    color: #555;
                                    font-size: 14px;
                                    font-weight: 600;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }

                                TouchArea {
                                    clicked => {
                                        root.dialog_cancelled();
                                    }
                                }
                            }
                            
                            // 确认按钮
                            Rectangle {
                                width: 90px;
                                height: 40px;
                                background: #FE9900;
                                border-radius: 6px;
                                Text {
                                    text: "确认";
                                    color: white;
                                    font-size: 14px;
                                    font-weight: 600;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }

                                TouchArea {
                                    clicked => {
                                        // 验证输入并创建股票
                                        if (stock_name != "" && transaction_price_text != "" && transaction_amount_text != "" && current_price_text != "") {
                                            root.open_stock_confirmed({
                                                stock_name: stock_name,
                                                stock_type: stock_type,
                                                current_price: current_price_text.to_float(),
                                                transaction_price: transaction_price_text.to_float(),
                                                transaction_amount: transaction_amount_text.to_float(),
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
