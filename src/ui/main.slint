import { Button, VerticalBox, HorizontalBox, ListView, LineEdit } from "std-widgets.slint";
import { OpenStockData,StockItem } from "./data.slint";
import { MainHeader } from "./components/mainHeader.slint";
import { StockListItem } from "./components/StockItem.slint";
import { CreateStockDialog } from "./components/CreateStockDialog.slint";

export component MainWindow inherits Window {
    title: "交易计算器";
    width: 800px;
    height: 600px;
    background: #f5f5f5;
    
    // 股票列表数据
    in property <[StockItem]> stock_list: [];
    
    // 对话框状态
    in-out property <bool> show_create_dialog: false;
    
    // 回调函数
    callback view_stock_details(int);
    callback delete_stock_item(int);
    callback create_new_stock();
    callback refresh_stock_list();
    callback create_stock_with_data(OpenStockData);

    VerticalBox {
        MainHeader {
            create_stock => {
                root.show_create_dialog = true;
            }
        }

        Rectangle {
            // 主要内容区域
            background: white;
            padding: 10px;
            VerticalBox {
                spacing: 5px;
                
                // 列表标题
                HorizontalBox {
                    padding: 10px;
                    Text {
                        text: "股票列表 (" + stock_list.length + " 只)";
                        font-size: 14px;
                        font-weight: 600;
                        color: #333;
                    }

                    Rectangle {
                        // 占位符推动刷新按钮到右边
                    }
                }
                
                // 股票列表
                if stock_list.length == 0: Rectangle {
                    height: 100px;
                    Text {
                        text: "暂无股票数据\n点击\"建仓\"按钮添加股票";
                        color: #999;
                        font-size: 14px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                if stock_list.length > 0: ListView {
                    for stock_item[index] in stock_list: StockListItem {
                        stock_data: stock_item;
                        view_stock(stock_id) => {
                            root.view_stock_details(stock_id);
                        }
                        delete_stock(stock_id) => {
                            root.delete_stock_item(stock_id);
                        }
                    }
                }
            }
        }
    }
    
    // 建仓对话框 - 覆盖在主界面上
    CreateStockDialog {
        show <=> root.show_create_dialog;
        open_stock_confirmed(data) => {
            root.show_create_dialog = false;
            root.create_stock_with_data(data);
        }
        dialog_cancelled => {
            root.show_create_dialog = false;
        }
    }
}
